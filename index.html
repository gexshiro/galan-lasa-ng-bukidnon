<!doctype html>
<html lang="tl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lasa ng Bukidnon</title>
<!-- Bagong Favicon na may Soft Green na kulay -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CclipPath id='a'%3E%3Cpath d='M0 0h100v100H0z'/%3E%3C/clipPath%3E%3C/defs%3E%3Cg fill='%2386A397' clip-path='url(%23a)'%3E%3Cpath d='M50 2.5C23.8 2.5 2.5 23.8 2.5 50S23.8 97.5 50 97.5 97.5 76.2 97.5 50 76.2 2.5 50 2.5zm0 10c20.7 0 37.5 16.8 37.5 37.5S70.7 87.5 50 87.5 12.5 70.7 12.5 50 29.3 12.5 50 12.5z'/%3E%3Cpath d='M69.8 50c0-10.9-8.9-19.8-19.8-19.8S30.2 39.1 30.2 50c0 8.9 5.9 16.4 14 18.9.6-2 .9-4 .9-6.1 0-7-5.7-12.7-12.7-12.7-2.1 0-4.1.5-5.9 1.5 3.3-12.2 14.9-21.2 28.5-21.2 16.5 0 29.8 13.3 29.8 29.8 0 2.7-.4 5.4-1 7.9-1.3-1-2.8-1.8-4.4-2.4-.1-1.8-.2-3.7-.2-5.7z'/%3E%3C/g%3E%3C/svg%3E">

<!-- Google Fonts: Playfair Display & Lora -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Lora:ital,wght@0,400..700;1,400..700&family=Shadows+Into+Light&display=swap" rel="stylesheet">
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  /* -------------------------
     Bagong Variables & Base Layout
     ------------------------- */
  :root {
    --cream: #FDFBF6;
    --soft-green: #86A397;
    --dark-text: #434E49;
    --muted-green: #CAD5D0;
    --border-color: rgba(67, 78, 73, 0.15);
  }
  
  /* Dark Mode Palette */
  body[data-theme="dark"] {
    --cream: #202a25; /* Softer dark background */
    --soft-green: #86A397;
    --dark-text: #f1f5f2; /* Brighter cream text for contrast */
    --muted-green: #5a786a;
    --border-color: rgba(202, 213, 208, 0.15);
  }


  body {
    background-color: var(--cream);
    background-image: url('https://www.transparenttextures.com/patterns/subtle-pinstripes.png');
    color: var(--dark-text);
    font-family: 'Lora', serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    transition: background-color 0.4s ease, color 0.4s ease;
  }

  /* Specific background for main content area to pop in dark mode */
  main, #about .bg-white {
    transition: background-color 0.4s ease;
  }
  body[data-theme="dark"] main, body[data-theme="dark"] #about .bg-white {
    background-color: #2a3a33;
  }

  h1, h2, h3, h4, .font-display {
    font-family: 'Playfair Display', serif;
  }

  .scribble, .postscript, .slam-book-answer {
    font-family: 'Shadows Into Light', cursive;
  }
  
  .bg-cream { background-color: var(--cream); }
  .text-soft-green { color: var(--soft-green); }
  .border-soft-green { border-color: var(--soft-green); }
  .bg-muted-green { background-color: var(--muted-green); }

  /* Smooth scroll */
  html {
    scroll-behavior: smooth;
  }
  
  /* Preloader Styles */
  #preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    background-color: var(--cream);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.75s ease, visibility 0.75s ease;
  }
  #preloader .preloader-logo {
    display: flex;
    flex-direction: column;
    align-items: center;
    animation: pulse-logo 2s infinite ease-in-out;
  }
  body.is-loaded #preloader {
    opacity: 0;
    visibility: hidden;
  }
  @keyframes pulse-logo {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.8; }
  }

  /* Drop Cap */
  .drop-cap::first-letter {
    font-family: 'Playfair Display', serif;
    font-size: 4.5em;
    float: left;
    line-height: 0.8;
    margin: 0.1em 0.1em 0 0;
    color: var(--soft-green);
  }
  
  /* Washi Tape Effect */
  .washi-tape {
      position: absolute;
      width: 120px;
      height: 30px;
      background: repeating-linear-gradient(45deg, rgba(134, 163, 151, 0.4), rgba(134, 163, 151, 0.4) 10px, rgba(202, 213, 208, 0.4) 10px, rgba(202, 213, 208, 0.4) 20px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border-left: 1px dashed rgba(255,255,255,0.2);
      border-right: 1px dashed rgba(255,255,255,0.2);
      z-index: 10;
  }
  .hero .washi-tape {
      top: -15px;
      left: 30px;
      transform: rotate(-4deg);
  }
   .about-section .washi-tape {
      top: -15px;
      right: -20px;
      transform: rotate(5deg);
  }
  .polaroid .washi-tape {
      width: 80px;
      height: 25px;
      top: -12px;
      left: -10px;
      transform: rotate(-6deg);
  }
  .polaroid:nth-of-type(2n) .washi-tape {
      left: auto;
      right: -10px;
      transform: rotate(6deg);
  }


  /* Image hover effect */
  figure.polaroid:hover img {
    transform: scale(1.03); /* Hover effect on the image */
    box-shadow: 0 15px 30px rgba(0,0,0,0.1);
  }
   figure.parallax-image {
    /* removed transition for smoother JS-driven parallax */
  }

  /* Reveal on Scroll Animation */
  .reveal-on-scroll {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
  }
  .reveal-on-scroll.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Flourish Divider */
  .flourish-divider {
    width: 100px;
    height: 20px;
    margin: 3rem auto;
    stroke: var(--muted-green);
    stroke-width: 1;
    fill: none;
  }

  /* Justified Text for Article */
  article.prose p {
    text-align: justify;
  }

  /* Styles for Integrated Captions */
  .integrated-caption p {
    font-family: 'Playfair Display', serif;
    font-weight: bold;
    color: var(--dark-text);
    margin-top: 0.75rem;
    font-size: 1.1rem;
    line-height: 1.3;
  }
  body[data-theme="dark"] .integrated-caption p {
    color: var(--dark-text);
  }
  .integrated-caption figcaption {
    font-family: 'Lora', serif;
    font-style: italic;
    color: var(--soft-green);
    font-size: 0.9rem;
    margin-top: 0.25rem;
  }

  /* Lightbox Styles */
  .lightbox-wrap{ display:none; position:fixed; z-index:1600; left:0; top:0; width:100%; height:100%; background: rgba(20,25,22,0.9); align-items:center; justify-content:center; flex-direction: column; }
  .lightbox-wrap.show{ display:flex; }
  .lightbox-img{ max-width:92%; max-height:80%; border-radius:8px; box-shadow:0 12px 40px rgba(0,0,0,0.9); }
  .lightbox-caption-wrap { margin-top: 14px; text-align: center; max-width: 80%; }
  .lightbox-caption { color: var(--cream); font-family: 'Playfair Display', serif; font-size: 18px; margin: 0; }
  .lightbox-subcaption { color: var(--muted-green); font-family: 'Shadows Into Light', cursive; font-size: 20px; margin-top: 4px; }
  .lightbox-close, .lightbox-nav { border-radius:999px; background:rgba(255,255,255,0.1); color:var(--cream); cursor:pointer; border:0; display:flex; align-items:center; justify-content:center; transition: background-color 0.2s; }
  .lightbox-close:hover, .lightbox-nav:hover { background:rgba(255,255,255,0.2); }
  .lightbox-close { position:absolute; top:18px; right:18px; font-size:28px; width: 48px; height: 48px;}
  .lightbox-nav { position:absolute; top:50%; transform:translateY(-50%); font-size:28px; width:48px; height:48px; }
  .lightbox-prev{ left:22px; }
  .lightbox-next{ right:22px; }
  .lightbox-counter {
    position: absolute;
    top: 24px;
    left: 24px;
    color: var(--cream);
    font-family: 'Lora', serif;
    font-size: 16px;
    opacity: 0.7;
  }

  /* Animated Doodles */
  .title-doodles {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 150%;
    height: 150%;
    transform: translate(-50%, -50%);
    pointer-events: none;
  }
  .sparkle {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: var(--soft-green);
    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
    animation: sparkle-anim 2s infinite ease-in-out;
  }
  .sparkle:nth-child(1) { top: 10%; left: 15%; animation-delay: 0s; }
  .sparkle:nth-child(2) { top: 80%; left: 10%; animation-delay: 0.5s; }
  .sparkle:nth-child(3) { top: 20%; left: 85%; animation-delay: 1s; }
  .sparkle:nth-child(4) { top: 70%; left: 90%; animation-delay: 1.5s; }
  @keyframes sparkle-anim {
    0%, 100% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1); opacity: 1; }
  }
  
  /* Widescreen 16:9 Vlog Container */
  .video-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    margin: 2rem auto;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 15px 30px rgba(0,0,0,0.1);
  }
  .video-container::before {
    content: '';
    display: block;
    padding-top: 56.25%; /* 16:9 Aspect Ratio */
  }
  .video-container #player, .video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  /* Animated Audio Icon */
  #audioToggle.is-playing {
    animation: pulse-audio 1.5s infinite ease-in-out;
  }
  @keyframes pulse-audio {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }

  /* Decorative Background Flourishes */
  .bg-flourish {
      position: fixed;
      width: 150px;
      height: 150px;
      pointer-events: none;
      opacity: 0.1;
      z-index: -1;
      transition: opacity 0.4s ease;
  }
  body[data-theme="dark"] .bg-flourish {
    opacity: 0.08;
  }
  .bg-flourish svg {
      width: 100%;
      height: 100%;
      stroke: var(--soft-green);
      stroke-width: 0.5;
      fill: none;
  }
  .flourish-top-left { top: 10px; left: 10px; transform: rotate(0deg); }
  .flourish-bottom-right { bottom: 10px; right: 10px; transform: rotate(180deg); }
  
</style>
</head>
<body data-theme="light" class="bg-cream text-dark-text antialiased">

  <!-- Preloader -->
  <div id="preloader">
    <div class="preloader-logo">
        <svg class="w-16 h-16 text-soft-green" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="clip-preloader"><path d="M0 0h100v100H0z"/></clipPath></defs><g clip-path="url(#clip-preloader)"><path d="M50 2.5C23.8 2.5 2.5 23.8 2.5 50S23.8 97.5 50 97.5 97.5 76.2 97.5 50 76.2 2.5 50 2.5zm0 10c20.7 0 37.5 16.8 37.5 37.5S70.7 87.5 50 87.5 12.5 70.7 12.5 50 29.3 12.5 50 12.5z" fill="currentColor"/><path d="M69.8 50c0-10.9-8.9-19.8-19.8-19.8S30.2 39.1 30.2 50c0 8.9 5.9 16.4 14 18.9.6-2 .9-4 .9-6.1 0-7-5.7-12.7-12.7-12.7-2.1 0-4.1.5-5.9 1.5 3.3-12.2 14.9-21.2 28.5-21.2 16.5 0 29.8 13.3 29.8 29.8 0 2.7-.4 5.4-1 7.9-1.3-1-2.8-1.8-4.4-2.4-.1-1.8-.2-3.7-.2-5.7z" fill="currentColor"/></g></svg>
        <span class="font-display font-bold text-xl mt-4">Lasa ng Bukidnon</span>
    </div>
  </div>
  
  <!-- Background Flourishes -->
  <div class="bg-flourish flourish-top-left">
    <svg viewBox="0 0 100 100"><path d="M5,95 C25,50 30,20 95,5" stroke-linecap="round"/><path d="M5,95 C30,80 60,80 70,95" stroke-linecap="round"/><path d="M95,5 C70,25 80,60 90,90" stroke-linecap="round"/></svg>
  </div>
  <div class="bg-flourish flourish-bottom-right">
    <svg viewBox="0 0 100 100"><path d="M5,95 C25,50 30,20 95,5" stroke-linecap="round"/><path d="M5,95 C30,80 60,80 70,95" stroke-linecap="round"/><path d="M95,5 C70,25 80,60 90,90" stroke-linecap="round"/></svg>
  </div>
    
  <!-- Sticky Header -->
  <header class="py-4 border-b border-border-color sticky top-0 bg-cream/80 backdrop-blur-sm z-50">
    <div class="container mx-auto max-w-5xl px-4 flex justify-between items-center">
      <a href="#" class="flex items-center gap-3 text-dark-text hover:text-soft-green transition-colors">
        <svg class="w-8 h-8 text-soft-green" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="clip-header"><path d="M0 0h100v100H0z"/></clipPath></defs><g clip-path="url(#clip-header)"><path d="M50 2.5C23.8 2.5 2.5 23.8 2.5 50S23.8 97.5 50 97.5 97.5 76.2 97.5 50 76.2 2.5 50 2.5zm0 10c20.7 0 37.5 16.8 37.5 37.5S70.7 87.5 50 87.5 12.5 70.7 12.5 50 29.3 12.5 50 12.5z" fill="currentColor"/><path d="M69.8 50c0-10.9-8.9-19.8-19.8-19.8S30.2 39.1 30.2 50c0 8.9 5.9 16.4 14 18.9.6-2 .9-4 .9-6.1 0-7-5.7-12.7-12.7-12.7-2.1 0-4.1.5-5.9 1.5 3.3-12.2 14.9-21.2 28.5-21.2 16.5 0 29.8 13.3 29.8 29.8 0 2.7-.4 5.4-1 7.9-1.3-1-2.8-1.8-4.4-2.4-.1-1.8-.2-3.7-.2-5.7z" fill="currentColor"/></g></svg>
        <span class="font-display font-bold text-xl">Lasa ng Bukidnon</span>
      </a>
      <nav class="flex items-center gap-10 text-sm">
        <a href="#journal" class="hover:text-soft-green transition-colors">Ang Kwento</a>
        <a href="#vlog" class="hover:text-soft-green transition-colors">Ang Vlog</a>
        <a href="#about" class="hover:text-soft-green transition-colors">Tungkol sa Akin</a>
        <a href="#" id="audioToggle" title="Toggle ambience" class="hover:text-soft-green transition-colors">♫</a>
        <a href="#" id="themeToggle" title="Toggle theme" class="hover:text-soft-green transition-colors">☾</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container mx-auto max-w-4xl px-4 py-8 sm:py-12">

    <!-- Article Header -->
    <div class="text-center mb-12 reveal-on-scroll relative">
      <div class="title-doodles">
        <div class="sparkle"></div><div class="sparkle"></div>
        <div class="sparkle"></div><div class="sparkle"></div>
      </div>
      <p class="text-sm text-soft-green uppercase tracking-widest">Isang Travel Journal</p>
      <h1 class="text-4xl md:text-6xl font-display font-bold leading-tight mt-2">3Fern: Isang Tanghali ng Liwanag at Lasa</h1>
      <p class="text-md text-dark-text/70 mt-4">Ni Jeffrey M. Galan III • Setyembre 27, 2025 • Maramag, Bukidnon</p>
    </div>

    <!-- Hero Image -->
    <figure class="mb-12 reveal-on-scroll relative hero">
      <div class="washi-tape"></div>
      <img class="rounded-lg shadow-lg w-full h-auto object-cover" src="hero-cafe-interior.jpg" alt="Loob ng isang cafe na may mainit na ilaw at mga gamit na gawa sa kahoy.">
    </figure>
    
    <!-- Blog Post Body -->
    <main id="journal" class="bg-white rounded-lg shadow-lg p-6 sm:p-10 md:p-12 relative">
      <article class="prose lg:prose-lg max-w-none text-dark-text relative z-10">
        
        <!-- Introduction -->
        <p class="text-lg leading-relaxed drop-cap reveal-on-scroll">
          Sa gitna ng maalikabok na kalsada at matinding sikat ng araw sa Maramag, may mga lugar na nagsisilbing kanlungan—isang paanyaya upang saglit na huminto at huminga. Ganito ang naging dating sa akin ng 3Fern Café. Hindi ito planado; isa itong kusang paghahanap ng lilim na nauwi sa isang karanasang higit pa sa inaasahan. Sa pagbukas pa lang ng pinto, bumungad ang halimuyak ng kapeng bagong giling at ang payapang katahimikan—isang malinaw na paalala na sa loob, iba ang takbo ng oras.
        </p>
        
        <div class="my-24 flex justify-center reveal-on-scroll">
            <figure class="polaroid cursor-pointer max-w-sm parallax-image" tabindex="0" data-full="polaroid-overall-place.jpg">
                <div class="washi-tape"></div>
                <img class="rounded-lg shadow-md w-full h-full object-cover" src="polaroid-overall-place.jpg" alt="Ang buong lugar ng 3Fern">
                <div class="integrated-caption text-center">
                    <p>Ang Loob ng Café</p>
                    <figcaption>Isang paanyaya para bumagal at huminga.</figcaption>
                </div>
            </figure>
        </div>

        <p class="text-lg leading-relaxed reveal-on-scroll">
            Ang sikat ng araw sa katanghalian, na karaniwa'y nakakasilaw, ay tila naging isang malumanay na ilaw sa loob ng café. Sumasayaw ito sa ibabaw ng mga mesang kahoy, nagbibigay-buhay sa bawat sulok, at nagiging mainit na yakap sa sinumang naroroon. Sa ilalim ng liwanag na ito, pinili ko ang <strong>Korean Beef Stew</strong> at <strong>Buffalo Wings</strong>. Isang ngiti mula sa staff ang naghatid ng menu, isang simpleng galaw na puno ng pag-aalaga.
        </p>
        
        <div class="my-24 grid grid-cols-2 gap-8 reveal-on-scroll">
            <figure class="polaroid cursor-pointer parallax-image" tabindex="0" data-full="polaroid-beef-stew.jpg">
                <div class="washi-tape"></div>
                <img class="rounded-lg shadow-md w-full h-full object-cover" src="polaroid-beef-stew.jpg" alt="Korean Beef Stew">
                <div class="integrated-caption text-center">
                    <p>Korean Beef Stew</p>
                    <figcaption>Init at linamnam na nagpapaalala sa tahanan.</figcaption>
                </div>
            </figure>
            <figure class="polaroid cursor-pointer parallax-image" tabindex="0" data-full="polaroid-buffalo-wings.jpg">
                <div class="washi-tape"></div>
                <img class="rounded-lg shadow-md w-full h-full object-cover" src="polaroid-buffalo-wings.jpg" alt="Buffalo Wings">
                <div class="integrated-caption text-center">
                    <p>Buffalo Wings</p>
                    <figcaption>Ang anghang na pumupukaw sa diwa.</figcaption>
                </div>
            </figure>
        </div>

        <!-- Blockquote -->
        <blockquote class="reveal-on-scroll my-10 text-center text-2xl font-display italic text-soft-green border-none">
            "Ang paglalakbay ay hindi tungkol sa layo kundi sa lalim ng sandaling iyong ninanamnam."
        </blockquote>
        
        <!-- Conclusion -->
        <p class="text-lg leading-relaxed reveal-on-scroll">
            Umuwi akong baon hindi lang ang lasa ng pagkain, kundi ang pakiramdam ng isang tanghaling puno ng liwanag. Ang pagbisita sa 3Fern Café ay nagturo sa akin na ang pinakamalalalim na karanasan sa paglalakbay ay madalas na natatagpuan sa mga pinakasimpleng sandali: ang init ng araw sa iyong balat, ang kabaitan sa ngiti ng isang estranghero, at ang katahimikang nagbibigay-daan sa iyong marinig ang sarili. Ang paglalakbay, natutunan ko, ay hindi nasusukat sa layo ng narating, kundi sa lalim ng kahulugang naiwan sa puso. Ito ang tunay na diwa ng paghahanap ng kanlungan—hindi sa lugar, kundi sa sandali.
        </p>
        
        <!-- Postscript -->
        <p class="postscript text-2xl text-right mt-8 reveal-on-scroll">
            P.S. Minsan, ang pinakamagandang destinasyon ay isang pakiramdam.
        </p>

      </article>
    </main>
    
    <!-- Vlog Section -->
    <section id="vlog" class="reveal-on-scroll mt-16">
      <h2 class="section-title text-center text-4xl font-display">Lasa ng Bukidnon: Ang Vlog</h2>
      <div class="video-container mt-8">
        <div id="player"></div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="reveal-on-scroll mt-16 pt-12 border-t border-border-color about-section">
        <h2 class="text-center text-4xl font-display mb-8">Tungkol sa Manunulat</h2>
        <div class="bg-white rounded-lg shadow-lg p-8 flex flex-col md:flex-row items-center gap-8 relative">
            <div class="washi-tape"></div>
            <img class="w-32 h-32 md:w-40 md:h-40 rounded-full object-cover shadow-md border-4 border-cream" src="about-author-portrait.jpg" alt="Larawan ni Jeffrey M. Galan III">
            <div class="text-center md:text-left">
                <h4 class="font-display text-2xl font-bold">Jeffrey M. Galan III</h4>
                <p class="text-sm text-dark-text/80 mt-2">Isang manlalakbay at manunulat na nangongolekta ng maliliit na alaala at isinusulat ang mga ito na parang mga postkard para sa kanyang sarili.</p>
                <div class="mt-4 pt-4 border-t border-border-color space-y-2 text-sm">
                    <p><strong><span class="font-display text-soft-green">Kasabihan:</span></strong> <span class="slam-book-answer">"Huwag bilangin ang byahe, bilangin ang mga alaala."</span></p>
                    <p><strong><span class="font-display text-soft-green">Paboritong Kape:</span></strong> <span class="slam-book-answer">Purong kape na may kaunting brown sugar.</span></p>
                    <p><strong><span class="font-display text-soft-green">Pangarap na Destinasyon:</span></strong> <span class="slam-book-answer">Sagada, para sa ulap at katahimikan.</span></p>
                </div>
            </div>
        </div>
    </section>
  </div>

  <!-- Footer -->
  <footer class="reveal-on-scroll text-center mt-12 pt-8 pb-8 border-t border-border-color">
    <div class="container mx-auto max-w-4xl px-4">
      <p class="text-md italic text-soft-green mb-4">“Ang paglalakbay ay hindi laging nasusukat sa layo, kundi sa mga munting inspirasyong naiiwan sa puso.”</p>
      <p class="text-xs text-dark-text/60">&copy; 2025 Lasa ng Bukidnon. Lahat ng Karapatan ay Nakalaan.</p>
    </div>
  </footer>

  <!-- Back to Top Button -->
  <button id="back-to-top" title="Bumalik sa Itaas" class="hidden fixed bottom-6 right-6 bg-soft-green text-white p-3 rounded-full shadow-lg hover:bg-dark-text transition-all focus:outline-none z-50">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" /></svg>
  </button>
  
  <!-- Lightbox (hidden by default) -->
  <div class="lightbox-wrap" id="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="lightbox-counter" id="lbCounter"></div>
    <button class="lightbox-close" id="lbClose" aria-label="Isara">✕</button>
    <button class="lightbox-nav lightbox-prev" id="lbPrev" aria-label="Nakaraan">‹</button>
    <img id="lbImg" class="lightbox-img" src="" alt="Pinalaking litrato">
    <div id="lbCaptionWrap" class="lightbox-caption-wrap">
      <p id="lbCaption" class="lightbox-caption"></p>
      <small id="lbSubCaption" class="lightbox-subcaption"></small>
    </div>
    <button class="lightbox-nav lightbox-next" id="lbNext" aria-label="Susunod">›</button>
  </div>

  <audio id="ambience" loop preload="none">
    <source src="audio-cafe-ambience.mp3" type="audio/mpeg">
  </audio>

<script>
document.addEventListener("DOMContentLoaded", function() {

  // --- DOM Element Selectors ---
  const body = document.body;
  const themeToggle = document.getElementById('themeToggle');
  const audioToggle = document.getElementById('audioToggle');
  const ambienceAudio = document.getElementById('ambience');
  const polaroidElements = Array.from(document.querySelectorAll('.polaroid'));
  const lightbox = {
    wrap: document.getElementById('lightbox'),
    img: document.getElementById('lbImg'),
    caption: document.getElementById('lbCaption'),
    subCaption: document.getElementById('lbSubCaption'),
    counter: document.getElementById('lbCounter'),
    closeBtn: document.getElementById('lbClose'),
    prevBtn: document.getElementById('lbPrev'),
    nextBtn: document.getElementById('lbNext'),
    currentIndex: -1
  };
  const backToTopButton = document.getElementById('back-to-top');

  // --- Preloader ---
  window.addEventListener('load', () => {
    document.body.classList.add('is-loaded');
  });

  // --- Theme Management ---
  function applyTheme(theme) {
    body.setAttribute('data-theme', theme);
    themeToggle.textContent = theme === 'dark' ? '☼' : '☾';
    localStorage.setItem('theme', theme);
  }

  function initTheme() {
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const defaultTheme = savedTheme || (prefersDark ? 'dark' : 'light');
    applyTheme(defaultTheme);
  }
  
  themeToggle.addEventListener('click', (e) => {
    e.preventDefault();
    const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
    applyTheme(newTheme);
  });

  // --- Audio Fading Logic ---
  let isAmbientMusicOn = false;
  const ambientVolume = 0.3;
  ambienceAudio.volume = 0;

  function fadeAudio(audioElement, targetVolume, duration = 1000) {
    const startVolume = audioElement.volume;
    const volumeChange = targetVolume - startVolume;
    if (volumeChange === 0) return;
    const stepInterval = 50;
    const totalSteps = duration / stepInterval;
    const volumeStep = volumeChange / totalSteps;
    let currentStep = 0;
    if (audioElement.fadeInterval) clearInterval(audioElement.fadeInterval);
    if (targetVolume > 0 && audioElement.paused) audioElement.play().catch(()=>{});
    audioElement.fadeInterval = setInterval(() => {
      currentStep++;
      if (currentStep >= totalSteps) {
        clearInterval(audioElement.fadeInterval);
        audioElement.volume = targetVolume;
        if (targetVolume === 0) audioElement.pause();
        return;
      }
      audioElement.volume = Math.max(0, Math.min(1, startVolume + (volumeStep * currentStep)));
    }, stepInterval);
  }

  // --- Lightbox Gallery ---
  function openLightbox(index) {
    if (index < 0 || index >= polaroidElements.length) return;
    const polaroid = polaroidElements[index];
    lightbox.img.src = polaroid.dataset.full || polaroid.querySelector('img')?.src || '';
    lightbox.caption.textContent = polaroid.querySelector('p')?.textContent || '';
    lightbox.subCaption.textContent = polaroid.querySelector('figcaption')?.textContent || '';
    lightbox.counter.textContent = `${index + 1} / ${polaroidElements.length}`;
    lightbox.wrap.classList.add('show');
    lightbox.currentIndex = index;
  }
  function closeLightbox() {
    lightbox.wrap.classList.remove('show');
  }
  function navigateLightbox(offset) {
    if (lightbox.currentIndex === -1) return;
    const newIndex = (lightbox.currentIndex + offset + polaroidElements.length) % polaroidElements.length;
    openLightbox(newIndex);
  }
  polaroidElements.forEach((el, index) => el.addEventListener('click', () => openLightbox(index)));
  lightbox.closeBtn.addEventListener('click', closeLightbox);
  lightbox.prevBtn.addEventListener('click', () => navigateLightbox(-1));
  lightbox.nextBtn.addEventListener('click', () => navigateLightbox(1));
  document.addEventListener('keydown', (e) => {
      if (lightbox.wrap.classList.contains('show')) {
          if (e.key === 'Escape') closeLightbox();
          if (e.key === 'ArrowLeft') navigateLightbox(-1);
          if (e.key === 'ArrowRight') navigateLightbox(1);
      }
  });


  // --- Event Listeners ---
  audioToggle.addEventListener('click', (e) => {
    e.preventDefault();
    isAmbientMusicOn = !isAmbientMusicOn;
    const icon = e.currentTarget;
    if (isAmbientMusicOn) {
      fadeAudio(ambienceAudio, ambientVolume, 1500);
      icon.classList.add('is-playing');
      icon.title = 'Pause ambience';
    } else {
      fadeAudio(ambienceAudio, 0, 1500);
      icon.classList.remove('is-playing');
      icon.title = 'Play ambience';
    }
  });

  // --- Reveal on Scroll ---
  const sections = document.querySelectorAll('.reveal-on-scroll');
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('is-visible');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1 });
  sections.forEach(section => observer.observe(section));

  // --- Back to Top & Parallax Scroll Events ---
  const parallaxImages = document.querySelectorAll('.parallax-image');
  window.addEventListener('scroll', () => {
    // Back to top
    if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
      backToTopButton.classList.remove('hidden');
    } else {
      backToTopButton.classList.add('hidden');
    }

    // Parallax
    parallaxImages.forEach(el => {
      const speed = -0.05; // Reduced speed for a more subtle effect
      const elementTop = el.getBoundingClientRect().top;
      const parallaxOffset = (elementTop - window.innerHeight / 2) * speed;
      el.style.transform = `translateY(${parallaxOffset}px)`;
    });
  });

  backToTopButton.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

  // --- YouTube API for Audio Control ---
  if(document.getElementById('vlog')) {
    let player;
    window.onYouTubeIframeAPIReady = function() {
      player = new YT.Player('player', {
        height: '100%',
        width: '100%',
        videoId: 'WpI9aoN-BlQ',
        playerVars: {
          'playsinline': 1,
          'rel': 0,
          'showinfo': 0,
          'modestbranding': 1,
          'origin': window.location.origin
        },
        events: {
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING && isAmbientMusicOn) {
        fadeAudio(ambienceAudio, 0, 800);
      } else if ((event.data == YT.PlayerState.PAUSED || event.data == YT.PlayerState.ENDED) && isAmbientMusicOn) {
        fadeAudio(ambienceAudio, ambientVolume, 800);
      }
    }
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  }
  
  // --- Initialization ---
  initTheme();
});
</script>
</body>
</html>
